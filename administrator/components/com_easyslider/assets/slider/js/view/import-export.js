void function(e,t,n,r){e.JSNES_Import_ExportrView=B.View.extend({el:"#jsnes-import-export",events:{"click .jsnes-export-data":"exportData","click .jsnes-import-data":"importData","click .close, .jsnes-close":"hide","click .jsnes-save":"saveData"},initialize:function(e){this.data=this.data||{},this.data.title="Export data",this.data.status="export",this.render()},render:function(){this.data&&this.data.title&&(this.$(".modal-title").text(this.data.title),this.$(".modal-body").html(""))},checkSelected:function(){var e=this,r=t('.jsn-column-select input[type="checkbox"]:checked');return this.listID=[],r.length>0&&n.each(r,function(n){var r=t(n).parent(".jsn-column-select").siblings(".jsn-column-id").text(),i=t(n).parent(".jsn-column-select").siblings(".jsn-column-title").find("a").text();e.listID.push({id:r,title:i})}),this.listID},exportData:function(){console.log("export"),this.data.status="export";var e=this,t=JSNES_SlidersData||{},r=this.checkSelected();r.length>0?(this.$(".modal").removeClass("hidden"),this.$(".modal-body").html(""),n.each(r,function(n){e.renderOneRow(t[n.id],n)})):alert("Please first make a selection from the list")},importData:function(){this.data.status="import",this.data.title="Import data",this.render(),t(".jsnes-import-input").trigger("click")},renderOneRow:function(e,r){var i=new RegExp("^(http|https)://","i"),s='<ul class="list-slide" slider-id="'+r.id+'">',o=JSON.parse(e);s+="<li><strong>"+r.title+"</strong></li>",n.each(o.slides,function(e){var t="",n=0;t+="background-color:"+(typeof e.background!="undefined"&&typeof e.background.color!="undefined"?e.background.color:"")+";",t+="background-position: center center;",t+="background-size: cover;",typeof e.background!="undefined"&&typeof e.background.image!="undefined"&&(i.test(e.background.image.src)?t+="background-image: url("+e.background.image.src+");":t+="background-image: url("+JSNES_UrlRoot+e.background.image.src+");"),typeof e.background!="undefined"&&typeof e.background.color!="undefined"&&(t+="background-color:"+e.background.color+";"),typeof e.index!="undefined"&&(n=e.index),s+='<li class="slide-data" slide-index="'+n+'" style="'+t+'">',s+='<input type="checkbox" />',s+="</li>"}),s+="</ul>",this.$(".modal-body").height(t(window).height()*.9),this.$(".modal-body").append(s),this.$('.modal-body input[type="checkbox"]').prop("checked",!0)},show:function(){this.$(".modal").removeClass("hidden")},hide:function(){t(".jsnes-import-input").val(""),this.$(".modal").addClass("hidden")},saveData:function(){this.data.status=="export"?this.exportSelectedData():this.data.status=="import"&&this.getImportDataSelected()},getImportDataSelected:function(){var e=this.$(".modal-body ul.list-slide"),r=[],i=this;this.importDataArray.length>0&&n.each(e,function(e){var s=parseInt(t(e).attr("slider-id")),o=i.importDataArray[s],u=t(e).find("li.slide-data input:checked"),a=[];n.each(u,function(e){var r=t(e).parent(),i=parseInt(r.attr("slide-index")),s=n.findWhere(o.slides,{index:i});typeof s=="undefined"&&(s=o.slides[i]),a.push(s)}),o.slides=a,r.push(o)}),i.hide();if(r.length>0){var s=t("#jsn-page-list").attr("token");t.ajax({url:"index.php?option=com_easyslider&task=sliders.importData&"+s+"=1",type:"POST",dataType:"json",data:{import_data:JSON.stringify(r)},error:function(){},complete:function(e){var t=JSON.parse(e.responseText);window.location.reload(),typeof t!="undefined"}})}},exportSelectedData:function(){var e=this.$(".modal-body ul.list-slide"),r={};n.each(e,function(e){var i=t(e).find("li").first().text(),s=parseInt(t(e).attr("slider-id")),o=JSON.parse(JSNES_SlidersData[s]);o.title=i;var u=t(e).find("li.slide-data input:checked"),a=[];n.each(u,function(e){var r=t(e).parent(),i=parseInt(r.attr("slide-index")),s=n.findWhere(o.slides,{index:i});typeof s=="undefined"&&(s=o.slides[i]),a.push(s)}),o.slides=a,r[s]=o});var i=JSON.stringify(r),s=new Blob([i],{type:"application/json"}),o=URL.createObjectURL(s),u=new Date,a=u.getDate()+"/"+(u.getMonth()+1)+"/"+u.getFullYear()+"-"+u.getHours()+":"+u.getMinutes(),f=document.createElement("a");f.href=o,f.download=a+".json",f.style="display: none",document.body.appendChild(f),f.click(),this.hide()},importDataFromFile:function(e){var t=this;this.importDataArray=[];var r="";if(e){if(this.checkFileAPI){var i=new FileReader;i.onload=function(e){r=e.target.result},i.onloadend=function(){if(/^[\],:{}\s]*$/.test(r.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){var e=JSON.parse(r);n.each(e,function(e,n){var r={};r.id=n,r.title=e.title,t.importDataArray[n]=e,t.renderOneRow(JSON.stringify(e),r)}),t.show()}else alert("this file is not JSON")},i.readAsText(e)}}else alert("Failed to load this file")},checkFileAPI:function(){return window.File&&window.FileReader&&window.FileList&&window.Blob?!0:(alert("The File APIs are not fully supported by your browser. Fallback required."),!1)}});var i=t(".jsnes-import").parent(),s=t(".jsnes-export").parent();i.removeAttr("onclick"),s.removeAttr("onclick"),i.append('<input type="file" class="jsnes-import-input" style="display:none;">'),t(".jsnes-import-input").click(function(e){e.stopPropagation()});var o=new JSNES_Import_ExportrView({sliders:[],model:new r.Model});t(".jsnes-import-input").on("change",function(e){var t=e.currentTarget.files[0];o.importDataFromFile(t),e.currentTarget.value=""}),i.click(function(e){o.importData()}),s.click(function(e){o.exportData()})}(this,JSNES_jQuery,JSNES_Underscore,JSNES_Backbone);